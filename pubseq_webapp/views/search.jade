html
  head
    title=title
    link(href='//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css', rel='stylesheet')
    script(type='text/javascript', src="http://code.jquery.com/jquery-1.9.1.min.js")
    script(type='text/javascript', src='http://fgnass.github.io/spin.js/spin.js')
    script.
      $(function () {
        $('#getseq').on('click', function () {
          var text = $('#seq');
          text.val('MEEPQSDPSVEPPLSQETFSDLWKLLPENNVLSPLPSQAMDDLMLSPDDIEQWFTEDPGPDEAPRMPEAAPPVAPAPAAPTPAAPAPAPSWPLSSSVPSQKTYQGSYGFRLGFLHSGTAKSVTCTYSPALNKMFCQLAKTCPVQLWVDSTPPPGTRVRAMAIYKQSQHMTEVVRRCPHHERCSDSDGLAPPQHLIRVEGNLRVEYLDDRNTFRHSVVVPYEPPEVGSDCTTIHYNYMCNSSCMGGMNRRPILTIITLEDSSGNLLGRNSFEVRVCACPGRDRRTEEENLRKKGEPHHELPPGSTKRALPNNTSSSPQPKKKPLDGEYFTLQIRGRERFEMFRELNEALELKDAQAGKEPGGSRAHSSHLKSKKGQSTSRHKKLMFKTEGPDSD');    
        });

        $('#seqform').on('submit', function(ev) {

          // removes onclick attribute from Query button
          $('#search').removeAttr('onclick');

          // prevents the form from submitting
          ev.preventDefault();
        
          console.log('clicked');

          // get the value of textarea
          var text = $('#seq');
          console.log(text.val());

          var body = document.getElementById('body');
          var spinner = new Spinner().spin();
          spinner.el.id = "spinner"
          //console.log(spinner.el);
          body.appendChild(spinner.el);

          setTimeout(function(){

            console.log("GET-ing from Solr server");

            $.ajax({
              method: "GET",
              url: "http://localhost:8983/solr/pubseq/select?wt=json&indent=true&q=*:*",
              dataType: "jsonp",
              jsonp:"json.wrf",
              success: function(data, textStatus) {

                console.log("removing spinner");
                $('.spinner').remove();

                console.log("GET done");

                var str = JSON.stringify(data, null, 2);

                console.log(str);
                
                window.location.replace('/results');
              },
              error: function(jqXHR, textStatus, errorThrown ) {
                console.log("Error %s: %s", errorThrown, textStatus);
              }
            });

          }, 2000);

        });
      });
      

  body(id='body')
    
    nav(class='navbar navbar-inverse navbar-fixed-top')
      div.container
        div(class='navbar-header')
          button(type='button' class='navbar-toggle collapsed' data-toggle='collapse' data-target='#navbar' aria-expanded='false' aria-controls='navbar')
            span(class='sr-only') Toggle navigation
            span(class='icon-bar')
            span(class='icon-bar')
            span(class='icon-bar')
          a(class='navbar-brand' href='/') PubSeq (v. 0.0.1)
        div(id='navbar' class='collapse navbar-collapse')
          ul(class='nav navbar-nav')
            li
              a(href='/') Home
            li(class='active')
              a(href='#') Search
            li
              a(href='/contact') Contact

    div.container
      div.jumbotron

        p

        form(role='form', id='seqform')
          
          div(class='form-group')
            label(for='seq') Sequence:
            textarea(class='form-control' rows='10', id='seq', style='font-family:monospace;')

          div.btn-group(role='form-group')
            button(type='button submit', 
              class='btn btn-primary',
              id='search'
              ) Query
            button(
              type='button',
              class='btn btn-primary',
              id='getseq'
            ) Give me a sequence!

